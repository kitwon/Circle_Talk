<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0,  user-scalable=0" name="viewport"><title>KIT</title><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/index.min.css"></head><body><nav class="nav-button-list"><div class="btn menu show-canvas"><span class="icon-bar"></span></div><div class="btn top btn-go-top"><i class="ion-arrow-up-c"></i><span class="scroll-percentage">0%</span></div></nav><div class="main-wrap"><div class="container"><div class="row"><div class="col-lg-3 side-bar-left"><div class="sidebar-content"><div class="main-side-bar"><div class="header"><p>爱好上班，特长加班</p><p>求职中</p><p>catslove28@163.com</p></div><nav class="side-bar-nav"><a href="/" class="item"><span>首页</span></a><a href="/archives" class="item m"><span>归档</span></a><a href="/tags" class="item last unopen"><span>标签</span></a></nav></div><div class="card directory-card"><div class="header">文章目录</div><div class="directory"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#从webpack1中迁移"><span class="nav-number">1.</span> <span class="nav-text">从webpack1中迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置文件"><span class="nav-number">1.1.</span> <span class="nav-text">配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#module-loaders变成module-rules"><span class="nav-number">1.1.1.</span> <span class="nav-text">module.loaders变成module.rules</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UglifyPlugin改动"><span class="nav-number">1.1.2.</span> <span class="nav-text">UglifyPlugin改动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ExtractTextWebpackPlugin"><span class="nav-number">1.1.3.</span> <span class="nav-text">ExtractTextWebpackPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLI中配置使用自定义参数"><span class="nav-number">1.1.4.</span> <span class="nav-text">CLI中配置使用自定义参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#主要变更"><span class="nav-number">1.2.</span> <span class="nav-text">主要变更</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ES6模块"><span class="nav-number">1.2.1.</span> <span class="nav-text">ES6模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">2.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">2.1.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div></div></div></div><div class="col-lg-9 main-content"><div class="post-detail-wrap content-wrap"><main class="post post-detail"><div class="post-header"><div class="header">webpack2新特性&迁移</div><section class="info"><div class="item"><i class="ion-android-calendar"></i><span>发表于 2017年6月24日</span></div><div class="item"><i class="ion-android-folder-open"></i><span>分类于 </span></div></section></div><article data-spy="scroll" data-target="panel1" class="content"><p>webpack2已经发布了好一段时间了。但是因为之前工作的关系没有好好研究一下，后面工作应该会用得上，而且趁着这段时间有空，还有在熟悉vim，就顺便拿这来练练手了。</p>
<h1 id="从webpack1中迁移"><a href="#从webpack1中迁移" class="headerlink" title="从webpack1中迁移"></a>从webpack1中迁移</h1><p>官方已经给出了详细的<a href="https://webpack.js.org/guides/migrating/" target="_blank" rel="external">迁移指南</a>，改动并不是很大，但是优化却蛮多的，如编译速度，代码优化等。如果你的项目正在用webpack，那么这个新版本还是挺值得迁移的。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>如果升级webpack之后直接运行命令的话应该会看到一片红的，可以看出配置项有改动，下面整理一下经常使用地方的改动。</p>
<h3 id="module-loaders变成module-rules"><a href="#module-loaders变成module-rules" class="headerlink" title="module.loaders变成module.rules"></a><code>module.loaders</code>变成<code>module.rules</code></h3><p>旧的<code>module.loader</code>被<code>module.rules</code>取代，后者允许配置<code>loader</code>更多选项，具体查看文档<a href="https://webpack.js.org/configuration/module/#module-rules" target="_blank" rel="external">module.rules</a></p>
<a id="more"></a>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">// ...
mdoule: {
    rules: [
        {
            test: /\.css$/,
            use: [
                { loader: &#39;style-loader&#39; },
                {
                    loader: &#39;css-loader&#39;,
                    options: { module: true }
                }
            ]
        },
        {
            test: /\.jsx$/,
            loader: &#39;babel-loader&#39;,
            options: {
                // ...
            }
        }
    ]
}
// ...
</code></pre>
<pre><code class="javascript">// ...
module: {
    rules: {
        test: /\.less$/,
        use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#39;less-loader&#39;]
    }
}
// ...
&lt;p class=&quot;code-caption&quot; data-lang=&quot;&quot; data-line_number=&quot;backend&quot; data-trim_indent=&quot;backend&quot; data-label_position=&quot;outer&quot; data-labels_left=&quot;Code&quot; data-labels_right=&quot;:&quot; data-labels_copy=&quot;Copy Code&quot;&gt;&lt;span class=&quot;code-caption-label&quot;&gt;&lt;/span&gt;&lt;/p&gt;
</code></pre>
<p>除上面两项外还有</p>
<ul>
<li>现在指定loader的时候不能再省略<code>-loader</code>后缀。具体原因参阅<a href="https://github.com/webpack/webpack/issues/2986" target="_blank" rel="external">#2968</a></li>
<li><code>json-loader</code>不需再手动添加。</li>
<li>loader默认的resolve配置是相对于<code>context</code>配置项的。</li>
<li>取消了<code>module.preLoaders</code>以及<code>module.postLoaders</code>。</li>
</ul>
<h3 id="UglifyPlugin改动"><a href="#UglifyPlugin改动" class="headerlink" title="UglifyPlugin改动"></a><code>UglifyPlugin</code>改动</h3><ul>
<li><code>UglifyPlugin</code>的<code>sourceMap</code>现在的默认值的<code>false</code>而不是<code>true</code>。</li>
<li><code>UglifyJsPlugin</code>的<code>compress.warnings</code>配置项现在默认为<code>false</code>而不是<code>true</code>。</li>
</ul>
<h3 id="ExtractTextWebpackPlugin"><a href="#ExtractTextWebpackPlugin" class="headerlink" title="ExtractTextWebpackPlugin"></a><code>ExtractTextWebpackPlugin</code></h3><p>插件变化主要体现在语法上，又原来的单个参数传变成了对象，现在的配置方式如下</p>
<pre><code class="javascript">// ExtractTextPlugin.extract
module: {
    rules: [
        test: /\.css$/,
        loader: ExtractTextPlugin.extract({
            fallbackLoader: &#39;style-loader&#39;,
            loader: &#39;css-loader&#39;,
            publicPath: &#39;/dist&#39;
        })
    ]
}

// new ExtractTextPlugin({options})
plugins: [
    new ExtractTextPlugin({
        filename: &#39;bundle.css&#39;,
        disabled: true,
        allChunks: true
    })
]
</code></pre>
<h3 id="CLI中配置使用自定义参数"><a href="#CLI中配置使用自定义参数" class="headerlink" title="CLI中配置使用自定义参数"></a>CLI中配置使用自定义参数</h3><p>在webpack1中可以用<code>process.argv</code>获取自定义参数，但是在webpack2中这行为被禁止了，替代地提供了一个接口<code>env</code>去获取自定义参数</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">module.export = function(env) {
    var customStuff = env.customStuff;

    // ...
    return config;
};
</code></pre>
<h2 id="主要变更"><a href="#主要变更" class="headerlink" title="主要变更"></a>主要变更</h2><h3 id="ES6模块"><a href="#ES6模块" class="headerlink" title="ES6模块"></a>ES6模块</h3><p>webpack2现在增加对ES6的模块化的原生支持，意味着现在能够直接识别<code>import</code>和<code>export</code>了，不需要先转成CommonJS模块的格式。<br>支持原生<code>import</code>带来的影响就是支持异步加载模块，webpack1使用异步模块的时候如下</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">require.ensure([&#39;a&#39;], function(a) {
    a.doSomething()
}, &#39;chunkName&#39;)
</code></pre>
<p>webpack2的<code>import</code>会返回一个<code>promise</code>对象</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">import(&#39;a&#39;).then(function(a) {
    a.doSomething()
})
</code></pre>
<p>而且现在<strong>chunk加载失败能被Promise捕捉到</strong>，那就意味着我们能够在组件加载失败的时候采取相应的操作。</p>
<p>另外现在<code>import</code>还支持动态表达式。</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">function route(path, query) {
    return import(&#39;/routes/${path}/route&#39;).then(route =&gt; new route.Route(query);
    })
}
</code></pre>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>用着<em>vim-mode</em>，写完这篇已经完全头皮发麻了，完全熟悉估计不知道还要多久呢。回正题，·从官方文档来看，改动的地方的确不多，迁移成本应该是比较低的，至于要不要迁移我觉得还是见仁见智吧，如果新版的优点好处大于迁移的成本的话各位应该可以放心去改动你的配置文件了。总的来说webpack2有以下几个优点</p>
<ul>
<li>编译速度提高</li>
<li>编译文件大小相对减少了</li>
<li>支持promise</li>
<li>能捕捉到chunk加载失败</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://webpack.js.org/guides/migrating/" target="_blank" rel="external">Migrating from v1 to v2</a></li>
<li><a href="http://www.tuicool.com/articles/aieAnan" target="_blank" rel="external">升级到 webpack2</a></li>
<li><a href="http://imweb.io/topic/58666d57b3ce6d8e3f9f99b0" target="_blank" rel="external">webpack2 的 tree-shaking 好用吗？</a></li>
</ul>
</article></main><div class="page-footer"><div class="post-pagination"><a href="/2017/06/14/深入学习javascript-闭包/">深入学习javascript-闭包<i class="ion-arrow-right-c"></i></a></div></div></div></div></div></div><div class="container-fluid copyright"><div> <span>©   2015 - 2016</span><i class="icon ion-ios-nutrition"></i><span>Kit</span></div><div><span>power by </span><span><a href="//hexo.io">hexo.</a></span><span>Design By Kit.</span></div></div></div><script src="/js/vendor.min.js"></script><script src="/js/post.min.js"></script></body></html>