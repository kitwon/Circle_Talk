<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0,  user-scalable=0" name="viewport"><title>KIT</title><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/index.min.css"></head><body><nav class="nav-button-list"><div class="btn menu show-canvas"><span class="icon-bar"></span></div><div class="btn top btn-go-top"><i class="ion-arrow-up-c"></i><span class="scroll-percentage">0%</span></div></nav><div class="main-wrap"><div class="container"><div class="row"><div class="col-lg-3 side-bar-left"><div class="sidebar-content"><div class="main-side-bar"><div class="header"><p>这里好像会有个搜索</p></div><nav class="side-bar-nav"><a href="/" class="item"><span>首页</span></a><a href="/archives" class="item m"><span>归档</span></a><a href="/tags" class="item last unopen"><span>标签</span></a></nav></div><div class="card directory-card"><div class="header">文章目录</div><div class="directory"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#配置"><span class="nav-number">1.</span> <span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#package-json"><span class="nav-number">1.1.</span> <span class="nav-text">package.json</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#跑个测试"><span class="nav-number">2.</span> <span class="nav-text">跑个测试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#last"><span class="nav-number">3.</span> <span class="nav-text">last</span></a></li></ol></div></div></div></div><div class="col-lg-9 main-content"><div class="post-detail-wrap content-wrap"><main class="post post-detail"><div class="post-header"><div class="header">在vue项目中使用jest进行单元测试</div><section class="info"><div class="item"><i class="ion-android-calendar"></i><span>发表于 2017年8月18日</span></div><div class="item"><i class="ion-android-folder-open"></i><span>分类于 <a href="/categories/前端自动化/">前端自动化</a></span></div></section></div><article data-spy="scroll" data-target="panel1" class="content"><p>在之前已经写过一篇关于前端单元测试的文章，相关概念就不作阐述了，有兴趣或者有需求的同学可以在往期找一下。然后这里简单介绍一下<a href="http://facebook.github.io/jest/" target="_blank" rel="external">jest</a>，这是一个<a href="https://code.facebook.com/projects/" target="_blank" rel="external">Facebook OpenSource</a>的一个开源项目。项目已经集成好了一些测试相关的框架的代码，主打的是零配置测试平台（react中应该算是零配置，其他项目还是要手动配置一下的），里面一个比较好地方是支持<strong>快照测试</strong>(为dom结构生成一个快照，每次测试都对比dom结构)。其他一些好用的地方可以自己查看文档，有中文。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>首先是安装jest, jset-vue-preprocessor(jest的一个插件，用来解析’.vue’文件的)。</p>
<p></p><p class="code-caption" data-lang="shell" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="shell">$npm install jest jest-vue-preprocessor --save-dev

$yarn add jest jest-vue-preprocessor --save
</code></pre>
<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><p>下面的配置都在<strong>package.json</strong>文件中配置。</p>
<p>在文件最底部添加下面代码</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">{
  // ...
  &quot;jest&quot;: {
    // 配置文件拓展名
    &quot;moduleFileExtensions&quot;: [
      &quot;js&quot;,
      &quot;vue&quot;
    ],
    // 匹配webpack中配置的alias
    &quot;moduleNameMapper&quot;: {
      &quot;^vue$&quot;: &quot;vue/dist/vue.common.js&quot;,
      &quot;^@(.*)$&quot;: &quot;&lt;rootDir&gt;/src$1&quot;
    },
    // 编译工具
    &quot;transform&quot;: {
      &quot;.*\\.(vue)$&quot;: &quot;&lt;rootDir&gt;/node_modules/jest-vue-preprocessor&quot;,
      &quot;.*&quot;: &quot;babel-jest&quot;
    }
  }
}
</code></pre>
<a id="more"></a>
<p>然后在上面<code>script</code>中添加一条新的命令</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">{
  // ...
  &quot;test&quot;: &quot;./node_modules/.bin/jest&quot;
}
</code></pre>
<p>然后就配置好了，很快，很舒服。</p>
<h1 id="跑个测试"><a href="#跑个测试" class="headerlink" title="跑个测试"></a>跑个测试</h1><p>首先，我有个vue组件cell，一个简单的列表item组件，代码如下</p>
<p></p><p class="code-caption" data-lang="vue" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="vue">&lt;template&gt;
  &lt;a class=&quot;ui-cell&quot; :href=&quot;href&quot;&gt;
    &lt;div class=&quot;ui-cell-wrapper&quot;&gt;
      &lt;slot name=&quot;icon&quot;&gt;
        &lt;i v-if=&quot;iconClass&quot; :class=&quot;iconClass&quot;&gt;&lt;/i&gt;
      &lt;/slot&gt;
      &lt;slot name=&quot;title&quot;&gt;
        &lt;div class=&quot;ui-cell-title&quot;&gt;
          &lt;div class=&quot;ui-cell-text&quot; v-text=&quot;title&quot;&gt;&lt;/div&gt;
          &lt;div class=&quot;ui-cell-label&quot; v-if=&quot;label&quot; v-text=&quot;label&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/slot&gt;
      &lt;div class=&quot;ui-cell-value&quot; :class=&quot;{ &#39;isLink&#39;: isLink }&quot;&gt;
        &lt;slot&gt;
           &lt;div v-text=&quot;value&quot;&gt;&lt;/div&gt;
        &lt;/slot&gt;
      &lt;/div&gt;
      &lt;i class=&quot;icon-arrow-right&quot; v-if=&quot;isLink&quot;&gt;&lt;/i&gt;
    &lt;/div&gt;
  &lt;/a&gt;
&lt;/template&gt;

...

&lt;script&gt;
  export default {
    name: &#39;ui-cell&#39;,
    props: {
      to: [String, Object],
      iconClass: String,
      title: String,
      label: String,
      value: {
        default: &#39;&#39;
      }
    },
    computed: {
      href () {
        if (this.to &amp;&amp; !this.added &amp;&amp; this.$router) {
          const resolve = this.$router.match(this.to)
          if (resolve.matched.length &lt;= 0) {
            return this.to
          }

          this.$nextTick(() =&gt; {
            this.added = true
            this.$el.addEventListener(&#39;click&#39;, this.handleClick)
          })
          return resolve.path
        }

        return this.to
      },
      isLink () {
        return !!this.to
      }
    },
    methods: {
      handleClick (e) {
        e.preventDefault()
        this.$router.push(this.href)
      }
    }
  }
&lt;/script&gt;
</code></pre>
<p>然后编写测试文件</p>
<p></p><p class="code-caption" data-lang="javascript" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="javascript">import Vue from &#39;vue&#39;
import Cell from &#39;@/components/cell&#39;
import VueRouter from &#39;vue-router&#39;

Vue.use(VueRouter)

const routes = [
  {
    path: &#39;/foo&#39;,
    component: Cell
  }
]
const router = new VueRouter({
  routes
})

const mockFn = jest.fn()
Cell.methods = {
  handleClick(e) {
    mockFn.mockReturnValue(true)
  }
}

const Constructor = Vue.extend(Cell)
const vm = new Constructor({
  propsData: {
    title: &#39;cell1&#39;,
    value: &#39;value1&#39;,
    label: &#39;label1&#39;
  }
}).$mount()

const vm2 = new Constructor({
  router,
  propsData: {
    title: &#39;cell2&#39;,
    value: &#39;value2&#39;,
    to: &#39;/foo&#39;
  }
}).$mount()

const vm3 = new Constructor({
  propsData: {
    title: &#39;cell3&#39;,
    value: &#39;value3&#39;,
    iconClass: &#39;icon-test&#39;
  }
}).$mount()

describe(&#39;Cell component&#39;, () =&gt; {
  test(&#39;render currect dom&#39;, () =&gt; {
    expect(vm.$el).toMatchSnapshot()
    expect(vm2.$el).toMatchSnapshot()
    expect(vm3.$el).toMatchSnapshot()
  })

  test(&#39;router action currectly run&#39;, () =&gt; {
    vm2.$nextTick(() =&gt; {
      vm2.$el.click()
      expect(vm2.href).toBe(vm2.to)
      expect(mockFn()).toBe(true)
    })
  })
})
</code></pre>
<p>然后跑一下命令</p>
<p></p><p class="code-caption" data-lang="shell" data-line_number="backend" data-trim_indent="backend" data-label_position="outer" data-labels_left="Code" data-labels_right=":" data-labels_copy="Copy Code"><span class="code-caption-label"></span></p><p></p>
<pre><code class="shell">$npm run test

&gt; jest-test@1.0.0 test /Users/kit/projects/jest-test
&gt; jest

 PASS  test/unit/Cell.spec.js
  Cell component
    ✓ render currect dom (8ms)
    ✓ router action currectly run (2ms)

Snapshot Summary
 › 3 snapshots written in 1 test suite.

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   3 added, 3 total
Time:        2.295
</code></pre>
<h1 id="last"><a href="#last" class="headerlink" title="last"></a>last</h1><p>jest给我们提供了一个便捷的测试环境，简单的几个配置项，即可完成编译，不像mocha或jasmine需要其他<code>node module</code>配合完成测试的工作。个人认为fb还是做到了他希望的，让测试变得简单，让开发者有更多的时间去开发。至于自动化测试的好处这里就不再赘述了，有兴趣的朋友可以自行baidu、google。</p>
</article></main><div class="page-footer"><div class="post-pagination"><a href="/2017/07/20/深入学习javascript-类/">深入学习javascript-类  <i class="ion-arrow-right-c"></i></a></div></div></div></div></div></div><div class="container-fluid copyright"><div> <span>©   2015 - 2016</span><i class="icon ion-ios-nutrition"></i><span>Kit</span></div><div><span>power by </span><span><a href="//hexo.io">hexo.</a></span><span>Design By Kit.</span></div></div></div><script src="/js/vendor.min.js"></script><script src="/js/post.min.js"></script></body></html>