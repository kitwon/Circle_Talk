<!DOCTYPE html><html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0,  user-scalable=0" name="viewport"><script src="/Circle_Talk/js/vendor/modernizr-2.6.2.min.js"></script><link rel="stylesheet" href="/Circle_Talk/css/index.min.css"></head><body><nav class="main-nav"><div class="container"><a class="btn menu"><span class="icon-bar"></span></a><button class="pull-right nav-button"><div class="graph-pos"><div class="sun"></div></div><div><div>Day</div><div>2016/04/10</div></div></button></div></nav><div class="side-bar"><ul class="col-xs-6 col-md-4"><li><a href="/">Home</a></li><li><a href="/archives/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="/copyright/">Copyright</a></li><li><a href="https://github.com/kitwon">github</a></li></ul><div class="black-cover"></div></div><main class="post-container"><div class="post"><header class="post-header"><h1 class="post-title">React-todo demo</h1><section class="post-meta"><time class="post-date"><i class="ion-ios-clock-outline"></i>Mar 2, 2016</time><span class="dot-sep">·</span><i class="ion-ios-pricetags-outline"></i><a href="/Circle_Talk/tags/React/">React</a><a href="/Circle_Talk/tags/Webpack/">Webpack</a><a href="/Circle_Talk/tags/js框架/">js框架</a></section></header></div><article class="content"><p>好久之前做得一个todo demo，使用了最近较火的react和webpack，由于公司电脑各种不能装，所以没用上es6（各种限制太惨了），在这顺便做个记录，年纪大记性太差了。</p>
<a id="more"></a>
<hr>
<h3 id="小科普"><a href="#小科普" class="headerlink" title="小科普"></a>小科普</h3><p>什么是React? 按官方解释，框架属于MVC中的view层，由于其设计思想独特，性能出众，逻辑简单，所以上年开始越来越多人关注。<br>至于Webpack，各位官人从名字应该可以猜出，是个打包工具，但又不止是个打包工具，是一个支持模块化的打包工具，两个字就可以形容它的优点了，就是暴力，纠结有多暴力，下面demo就为各位官人揭晓！</p>
<hr>
<h3 id="Demo功能需求"><a href="#Demo功能需求" class="headerlink" title="Demo功能需求"></a>Demo功能需求</h3><ul>
<li>input输入内容，回车键或按钮增加一条todo</li>
<li>checkbox添加完成状态</li>
<li>移动到列表时显示删除</li>
<li>显示todo总数和已经完成数</li>
<li>list全选</li>
<li>清除已完成</li>
<li>添加动画效果</li>
</ul>
<hr>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>开始需要npm安装一下等下要用的packages，如果是checkout我的demo，就动动手指头，install一下<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install</span><br></pre></td></tr></table></figure></p>
<hr>
<h4 id="配置webpack"><a href="#配置webpack" class="headerlink" title="配置webpack"></a>配置webpack</h4><p>所有东西安装完成之后首先就是配置<a href="http://webpack.github.io/docs/" target="_blank" rel="external">webpack</a><br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	entry : <span class="string">"./src/entry.js"</span>,</span><br><span class="line">	output : &#123;</span><br><span class="line">		path : path.join(__dirname, <span class="string">"out"</span>),</span><br><span class="line">		publicPath : <span class="string">"./out/"</span>,</span><br><span class="line">		filename : <span class="string">"bundle.js"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	externals : &#123;</span><br><span class="line">		react : <span class="string">"React"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="built_in">module</span> : &#123;</span><br><span class="line">		loaders : [</span><br><span class="line">			&#123; test : <span class="regexp">/\.js$/</span>, loader : <span class="string">"jsx"</span>,include: <span class="regexp">/src/</span> &#125;,</span><br><span class="line">			&#123; test : <span class="regexp">/\.css$/</span>, loader : <span class="string">"style!css"</span> &#125;,</span><br><span class="line">			&#123; test : <span class="regexp">/\.less$/</span>, loader : <span class="string">"style!css!less"</span> &#125;,</span><br><span class="line">			&#123; test : <span class="regexp">/\.(jpg|png)$/</span>, loader : <span class="string">"url?limit=8192"</span> &#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>从上面可以看到，webpack的入口文件是<code>entry.js</code>，打包输出的文件是<code>bundle.js</code>，external属性是告诉webpack，当API已经存在的时候，使用全局变量，并不作任何操作。</p>
<p>loader的话没啥，看文档就知道，各种编译打包。具体使用方法可以看官方文档。</p>
<hr>
<h4 id="上代码"><a href="#上代码" class="headerlink" title="上代码"></a>上代码</h4><figure class="highlight jsx"><figcaption><span>App.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'React'</span>),</span><br><span class="line">	ReactDOM = <span class="built_in">require</span>(<span class="string">'react-dom'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'../less/app.less'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> AppFooter = <span class="built_in">require</span>(<span class="string">'./AppFooter'</span>),</span><br><span class="line">	AppHeader = <span class="built_in">require</span>(<span class="string">'./AppHeader'</span>),</span><br><span class="line">	ItemMain = <span class="built_in">require</span>(<span class="string">'./ItemMain'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> App = React.createClass (&#123;</span><br><span class="line">	getInitialState : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			todoItem : [],</span><br><span class="line">			isAllChecked : <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//添加todo</span></span><br><span class="line">	addItem : <span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> todoList = <span class="keyword">this</span>.state.todoItem.push(item);</span><br><span class="line">		<span class="keyword">this</span>.setState(&#123;isAllChecked : <span class="literal">false</span>&#125;);</span><br><span class="line">		<span class="keyword">this</span>.forceUpdate();</span><br><span class="line">	&#125;,</span><br><span class="line">	 <span class="comment">//更改todo状态</span></span><br><span class="line">	changeTodoState : <span class="function"><span class="keyword">function</span>(<span class="params">index, isDone, isAllChange</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// isAllChange = false;</span></span><br><span class="line">		<span class="keyword">if</span>(isAllChange) &#123;</span><br><span class="line">			<span class="keyword">this</span>.setState(&#123;</span><br><span class="line">				todoItem: <span class="keyword">this</span>.state.todoItem.map(<span class="function"><span class="keyword">function</span>(<span class="params">todo</span>) </span>&#123;</span><br><span class="line">					todo.isDone = isDone;</span><br><span class="line">					<span class="keyword">return</span> todo;</span><br><span class="line">				&#125;),</span><br><span class="line">				isAllChecked : isDone</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.state.todoItem[index].isDone = isDone;</span><br><span class="line">			<span class="keyword">this</span>.allChecked();</span><br><span class="line">			<span class="keyword">this</span>.forceUpdate();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//删除todo</span></span><br><span class="line">	deleteTodo : <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> newTodo = <span class="keyword">this</span>.state.todoItem.splice(index, <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">this</span>.setState(&#123;todoList: newTodo&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//清楚已完成</span></span><br><span class="line">	clearDone : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> doneList = <span class="keyword">this</span>.state.todoItem.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> item.isDone === <span class="literal">false</span>;</span><br><span class="line">		&#125;)</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">this</span>.setState(&#123;todoItem: doneList, isAllChecked: <span class="literal">false</span>&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//全部完成</span></span><br><span class="line">	allChecked : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> allCheck = <span class="keyword">this</span>.state.todoItem.every(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> item.isDone === <span class="literal">true</span>;</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> (allCheck) &#123;</span><br><span class="line">			<span class="keyword">this</span>.setState(&#123;isAllChecked : <span class="literal">true</span>&#125;)</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;,</span><br><span class="line">    	render : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    		<span class="keyword">var</span> props = &#123;</span><br><span class="line">    			todoLength : <span class="keyword">this</span>.state.todoItem.length || <span class="number">0</span>,</span><br><span class="line">    			doneLength : <span class="keyword">this</span>.state.todoItem.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">    				<span class="keyword">return</span> item.isDone === <span class="literal">true</span>;</span><br><span class="line">    			&#125;).length || <span class="number">0</span></span><br><span class="line">    		&#125;;</span><br><span class="line">    	    	<span class="keyword">return</span> (</span><br><span class="line">    	        	&lt;div className="panel"&gt;</span><br><span class="line">    	        		&lt;header  className="mainHeader"&gt;&lt;h2&gt;Webpack + React TODO Demo&lt;/h2&gt;&lt;/header&gt;</span><br><span class="line">    	        		&lt;AppHeader addItem=&#123;this.addItem&#125;/&gt;</span><br><span class="line">    	        		&lt;ItemMain itemList=&#123;this.state.todoItem&#125; changeTodoState=&#123;this.changeTodoState&#125; deleteTodo=&#123;this.deleteTodo&#125; /&gt;</span><br><span class="line">    	        	    	&lt;AppFooter &#123;...props&#125; isAllChecked=&#123;this.state.isAllChecked&#125; clearDone=&#123;this.clearDone&#125; changeAllState=&#123;this.changeTodoState&#125; /&gt;</span><br><span class="line">    	        	&lt;/div&gt;</span><br><span class="line">    	    	)</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App/&gt;, document.getElementById("app"));  //渲染</span><br></pre></td></tr></table></figure>
<p>从代码上面可以看到各种require，没加载commonjs、seajs或其他模块化工具，为什么能直接require呢，而且还有require less，没错，webpack就是那么暴力！js后面都会打包好一个文件，样式都会加载到html里面，做spa时候，和react简直绝配。</p>
<h4 id="App生命-state"><a href="#App生命-state" class="headerlink" title="App生命 - state"></a>App生命 - state</h4><p>React主流思想就是父组件控制state，然后通过props传递给子组建，所以简单来说界面就像状态机，只要更新state，然后根据新的state重新渲染界面，不需要操作dom，所以react高性能原因也是因为这个。<br>从最上代码就可以看出父组件中的定义的方法基本是整个todo的功能了，然后render方法即渲染html和组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ItemMain itemList=&#123;<span class="keyword">this</span>.state.todoItem&#125; changeTodoState=&#123;<span class="keyword">this</span>.changeTodoState&#125; deleteTodo=&#123;<span class="keyword">this</span>.deleteTodo&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>然后取一小段渲染组件代码（上面代码）就可发现，父组件向ItemMain这个组件传了4个属性，其中itemList为state，只要todoItem一更新，react就会重新渲染这个组件，其他三个为方法，方法更新也会重新渲染组件。</p>
<h5 id="组件方法"><a href="#组件方法" class="headerlink" title="组件方法"></a>组件方法</h5><figure class="highlight js"><figcaption><span>Item.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'React'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Items = React.createClass(&#123;</span><br><span class="line">	handleChange : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> isDone = !<span class="keyword">this</span>.props.isDone;</span><br><span class="line">		<span class="keyword">this</span>.props.changeTodoState(<span class="keyword">this</span>.props.index, isDone);</span><br><span class="line">	&#125;,</span><br><span class="line">	handleDeleteTodo : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.props.deleteTodo(<span class="keyword">this</span>.props.index);</span><br><span class="line">	&#125;,</span><br><span class="line">	render : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> doneStyle = <span class="keyword">this</span>.props.isDone ? &#123;textDecoration: <span class="string">'line-through'</span>&#125; : &#123;textDecoration : <span class="string">'none'</span>&#125;;</span><br><span class="line">		<span class="keyword">return</span> (</span><br><span class="line">			&lt;li key=&#123;this.props.key&#125; onMouseOver=&#123;this.handlerMouseOver&#125; onMouseOut=&#123;this.handlerMouseOut&#125;&gt;</span><br><span class="line">				&lt;input type="checkbox" checked=&#123;this.props.isDone&#125; onChange=&#123;this.handleChange&#125; /&gt;</span><br><span class="line">				&lt;span style=&#123;doneStyle&#125;&gt;&#123;this.props.text&#125;&lt;/span&gt;</span><br><span class="line">				&lt;button className="btn btn-default delete-item" onClick=&#123;this.handleDeleteTodo&#125;&gt;delete&lt;/button&gt;</span><br><span class="line">			&lt;/li&gt;</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = Items;</span><br></pre></td></tr></table></figure>
</article></main><script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script><script>window.jQuery || document.write('<script src="js/vendor/jquery-1.9.0.min.js"><\/script>')</script><script src="/Circle_Talk/js/post.min.js"></script></body></html>